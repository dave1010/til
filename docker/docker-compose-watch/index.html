<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="/assets/css/styles.css">
  </head>
  <body>
    <header>
        <h1><a href="/">Dave Hulbert's Today I Learned (TIL)</a></h1>
    </header>

    <main>
        <hr>
        <section>
            <h1>Using Docker Compose Watch instead of Bind Mounts</h1>
<h2>Docker Volumes</h2>
<p>The standard way to keep files in sync between a Docker container and your host is using
volumes. These use (normally) use <a href="https://docs.docker.com/storage/bind-mounts/">bind mounts</a> under the hood.</p>
<p>You can do this on the command line:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-v</span> /path/to/local/dir:/path/in/container <span class="token punctuation">[</span>other-options<span class="token punctuation">]</span> <span class="token punctuation">[</span>image-name<span class="token punctuation">]</span></code></pre>
<p>Or in a <code>docker-compose.yml</code> file:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">your-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>image
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /path/to/local/dir<span class="token punctuation">:</span>/path/in/container</code></pre>
<h2>Watch</h2>
<p>Docker Compose <a href="https://github.com/docker/compose/releases/tag/v2.22.0">v2.22 was released in Sept 2023</a> and includes a new
<a href="https://docs.docker.com/compose/file-watch/">file watching capability</a>.</p>
<p>This allows you to easily sync just your source files to the container and then trigger commands when they change.
This is handy as it means you can do <code>npm install</code> or <code>composer install</code> on your host and in the container and
they can have platform-specific dependencies.</p>
<p>Here it is in the compose file in the <a href="https://docs.docker.com/compose/compose-file/develop/"><code>develop</code> section</a>:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">your-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>image
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /path/to/local/dir<span class="token punctuation">:</span>/path/in/container
    <span class="token key atrule">develop</span><span class="token punctuation">:</span>
      <span class="token key atrule">watch</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> src/
          <span class="token key atrule">target</span><span class="token punctuation">:</span> /app/src/
          <span class="token key atrule">action</span><span class="token punctuation">:</span> sync</code></pre>
<p>You can also use other actions:</p>
<ul>
<li><code>rebuild</code> will make Docker rebuild the container when the files change</li>
<li><code>sync+restart</code> will make Docker sync and then reboot the container</li>
</ul>
<p>Once you have this in your compose file, just run the new command:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> compose <span class="token function">watch</span></code></pre>
<p>and then it will keep the paths in sync, similar to if you had manually set up
<a href="https://linux.die.net/man/1/inotifywait"><code>inotifywait</code></a> or <a href="https://github.com/emcrisostomo/fswatch"><code>fswatch</code></a>.</p>

        </section>

        <hr>

        <footer>
            <p>
                &copy; Dave Hulbert<br><a href="/">Home</a>
                    |
                    <a href="https://github.com/dave1010/til/blob/main/./docker/docker-compose-watch.md" target="_blank">Edit this page on GitHub</a></p>
        </footer>
    </main>
  </body>
</html>
